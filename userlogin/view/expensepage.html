<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add expense</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
</head>

<body>
    <div class="inputbox">
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" class="amount" />
        <label for="description">Description:</label>
        <input type="text" id="description" name="description" class="description" />
        <label for="category">Category:</label>
        <select id="category" name="category" class="category">
            <option>Fuel</option>
            <option>Cinema</option>
            <option>Food</option>
            <option>Utensils</option>
        </select>
        <button type="submit" id="add_expense">Add expense</button>
    </div>
    <div class="listbox">
        <ul class="listitems"></ul>
    </div>
</body>
<script>
    async function getoldexpense(){
        try{
          const old_expenses= await axios.get('http://localhost:3000/user/getexpense',{withCredentials:true})
          old_expenses.data.forEach(old_expense=>{
            addexpense_list(old_expense);
          })
        }catch (err){
            console.log(err);
        }
    }
    
    // Call fetchExpenses when the page loads
    window.onload = getoldexpense;

    document.getElementById("add_expense").addEventListener('click',async()=>{
        const amount=document.getElementById("amount").value;
        const description=document.getElementById("description").value;
        const category=document.getElementById("category").value;
        try{
            const response=await axios.post('http://localhost:3000/user/addexpense', { amount, description,category },{ withCredentials: true })
            console.log(response.data);
            addexpense_list(response.data);
            }catch (error){
            console.log(error);
        }
    })
    function addexpense_list(expense){
         // Create list item and button
    const expenselist = document.createElement("li");
    expenselist.className = "expenselists";
    expenselist.textContent = `${expense.amount}\t\t${expense.description}\t\t${expense.category}`;


    const deleteButton = document.createElement("button");
    deleteButton.textContent = "Delete"; // Set button text
    deleteButton.className = "delete-button"; // Optional class for styling or functionality

    // Append both to the list item container
    const listItemContainer = document.createElement("div");
    listItemContainer.className="listdiv";
    listItemContainer.appendChild(expenselist);
    listItemContainer.appendChild(deleteButton);

    // Append to the main list
    document.querySelector('.listitems').appendChild(listItemContainer);
    }
</script>
</html>